---
description: Development workflow and best practices
---

# å¼€å‘å·¥ä½œæµç¨‹å’Œæœ€ä½³å®è·µ

## ğŸ”„ æ ‡å‡†å¼€å‘æµç¨‹

### 1. æœ¬åœ°å¼€å‘
```bash
cd /home/leiyi/codeSpace/ApiRelay/claude-relay-service

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æˆ–ä½¿ç”¨ nodemon è‡ªåŠ¨é‡å¯
nodemon src/app.js
```

### 2. ä»£ç æ£€æŸ¥
```bash
# è¿è¡Œ ESLint
npm run lint

# è‡ªåŠ¨ä¿®å¤é—®é¢˜
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format
```

### 3. æäº¤ä»£ç 
```bash
# æŸ¥çœ‹ä¿®æ”¹
git status

# æ·»åŠ æ–‡ä»¶
git add .

# æäº¤ï¼ˆä½¿ç”¨æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯ï¼‰
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"
# æˆ–
git commit -m "fix: ä¿®å¤æŸä¸ªé—®é¢˜"
# æˆ–
git commit -m "refactor: é‡æ„æŸä¸ªæ¨¡å—"

# æ¨é€åˆ°è¿œç¨‹
git push origin main
```

### 4. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼ˆå¼ºçƒˆæ¨èï¼‰
./scripts/deploy.sh

# éƒ¨ç½²ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š
# âœ… ç¯å¢ƒæ£€æŸ¥
# âœ… ä»£ç ä¸Šä¼ 
# âœ… æœåŠ¡é‡å¯
# âœ… å¥åº·æ£€æŸ¥
# âœ… API æµ‹è¯•
```

### 5. éªŒè¯éƒ¨ç½²
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
export ADMIN_TOKEN="your-admin-token"
node scripts/test-api.js

# æŸ¥çœ‹æ—¥å¿—
./scripts/view-logs.sh -e -n 50

# æ£€æŸ¥ç¯å¢ƒ
./scripts/check-env.sh
```

## ğŸ“ æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯ï¼š

- `feat:` - æ–°åŠŸèƒ½
- `fix:` - ä¿®å¤ bug
- `refactor:` - é‡æ„ä»£ç 
- `docs:` - æ–‡æ¡£æ›´æ–°
- `style:` - ä»£ç æ ¼å¼è°ƒæ•´
- `test:` - æµ‹è¯•ç›¸å…³
- `chore:` - æ„å»º/å·¥å…·ç›¸å…³

**ç¤ºä¾‹**:
```bash
git commit -m "feat: æ·»åŠ ç”¨æˆ·å¯¼å‡ºåŠŸèƒ½"
git commit -m "fix: ä¿®å¤è®¢å•åˆ—è¡¨ 401 é”™è¯¯"
git commit -m "refactor: ä¼˜åŒ–è®¤è¯ä¸­é—´ä»¶"
git commit -m "docs: æ›´æ–°éƒ¨ç½²æ–‡æ¡£"
```

## ğŸ”§ æ·»åŠ æ–°çš„ API æ¥å£

### 1. åˆ›å»ºè·¯ç”±
åœ¨ [src/routes/admin.js](mdc:src/routes/admin.js) ä¸­æ·»åŠ ï¼š

```javascript
// æ–°æ¥å£
router.get('/new-endpoint', authenticateAdmin, async (req, res) => {
  try {
    // ä¸šåŠ¡é€»è¾‘
    const data = await someService.getData();
    
    res.json({
      success: true,
      data
    });
  } catch (error) {
    logger.error('Error in new endpoint:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});
```

### 2. æ·»åŠ å‰ç«¯ API è°ƒç”¨
åœ¨ [commercial-website/src/lib/admin/api-client.ts](mdc:commercial-website/src/lib/admin/api-client.ts) ä¸­æ·»åŠ ï¼š

```typescript
async getNewData(): Promise<any> {
  const client = getAdminApiClient();
  const response = await client.get('/new-endpoint');
  return extractData(response);
}
```

### 3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹
åœ¨ [scripts/test-api.js](mdc:scripts/test-api.js) ä¸­æ·»åŠ ï¼š

```javascript
{
  name: 'æµ‹è¯•æ–°æ¥å£',
  method: 'GET',
  url: '/admin/new-endpoint',
  auth: true,
  expect: { status: 200, hasData: true }
}
```

### 4. éƒ¨ç½²å’Œæµ‹è¯•
```bash
# éƒ¨ç½²
./scripts/deploy.sh

# æµ‹è¯•
export ADMIN_TOKEN="your-token"
node scripts/test-api.js
```

## ğŸ› è°ƒè¯•æŠ€å·§

### åç«¯è°ƒè¯•
```javascript
// ä½¿ç”¨ logger
const logger = require('./utils/logger');

logger.info('Info message');
logger.warn('Warning message');
logger.error('Error message', error);
logger.debug('Debug message', { data });
```

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
# å®æ—¶è·Ÿè¸ªæ‰€æœ‰æ—¥å¿—
./scripts/view-logs.sh -f

# åªçœ‹é”™è¯¯
./scripts/view-logs.sh -f -e

# æœç´¢ç‰¹å®šå†…å®¹
./scripts/view-logs.sh -s "MongoDB"
```

### å‰ç«¯è°ƒè¯•
```typescript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°
console.log('ğŸ“¦ Data:', data);
console.error('âŒ Error:', error);

// æŸ¥çœ‹ API è¯·æ±‚
// æ‰“å¼€ Network æ ‡ç­¾ï¼Œç­›é€‰ XHR/Fetch
```

## ğŸ” å¸¸è§å¼€å‘åœºæ™¯

### åœºæ™¯ 1: ä¿®æ”¹ç°æœ‰æ¥å£

1. æ‰¾åˆ°å¯¹åº”çš„è·¯ç”±æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ `src/routes/`ï¼‰
2. ä¿®æ”¹ä¸šåŠ¡é€»è¾‘
3. æœ¬åœ°æµ‹è¯•
4. éƒ¨ç½²ï¼š`./scripts/deploy.sh`
5. éªŒè¯ï¼š`node scripts/test-api.js`

### åœºæ™¯ 2: æ·»åŠ æ–°çš„æ•°æ®åº“æ¨¡å‹

1. åœ¨ `src/models/` åˆ›å»ºæ–°æ¨¡å‹
2. å®šä¹‰ Mongoose Schema
3. åœ¨è·¯ç”±ä¸­ä½¿ç”¨æ¨¡å‹
4. æ›´æ–°ç›¸å…³æ¥å£
5. éƒ¨ç½²å’Œæµ‹è¯•

### åœºæ™¯ 3: ä¿®å¤ç”Ÿäº§ç¯å¢ƒ Bug

1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`./scripts/view-logs.sh -e`
2. æœ¬åœ°å¤ç°é—®é¢˜
3. ä¿®å¤ä»£ç 
4. æœ¬åœ°æµ‹è¯•
5. å¿«é€Ÿéƒ¨ç½²ï¼š`./scripts/deploy.sh`
6. éªŒè¯ä¿®å¤ï¼š`node scripts/test-api.js`
7. æŒç»­ç›‘æ§ï¼š`./scripts/view-logs.sh -f -e`

### åœºæ™¯ 4: æ•°æ®åº“è¿ç§»

1. åˆ›å»ºè¿ç§»è„šæœ¬
2. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
3. å¤‡ä»½ç”Ÿäº§æ•°æ®
4. æ‰§è¡Œè¿ç§»
5. éªŒè¯æ•°æ®å®Œæ•´æ€§
6. éƒ¨ç½²ç›¸å…³ä»£ç 

## âš ï¸ æ³¨æ„äº‹é¡¹

### éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•
- [ ] ä»£ç å·²æäº¤åˆ° Git
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] æ²¡æœ‰ ESLint é”™è¯¯
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æ•°æ®åº“è¿ç§»å·²å‡†å¤‡ï¼ˆå¦‚éœ€è¦ï¼‰

### éƒ¨ç½²åéªŒè¯æ¸…å•
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡ï¼š`curl https://api.codewith.site/health`
- [ ] API æµ‹è¯•é€šè¿‡ï¼š`node scripts/test-api.js`
- [ ] æ²¡æœ‰é”™è¯¯æ—¥å¿—ï¼š`./scripts/view-logs.sh -e`
- [ ] å‰ç«¯åŠŸèƒ½æ­£å¸¸
- [ ] æœåŠ¡è¿›ç¨‹è¿è¡Œä¸­ï¼š`ps aux | grep node`

### ç¦æ­¢æ“ä½œ
- âŒ ç›´æ¥åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šä¿®æ”¹ä»£ç 
- âŒ ä¸ç»æµ‹è¯•ç›´æ¥éƒ¨ç½²
- âŒ åˆ é™¤å¤‡ä»½æ–‡ä»¶
- âŒ åœ¨ç”Ÿäº§ç¯å¢ƒè°ƒè¯•
- âŒ ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯

### æ¨èæ“ä½œ
- âœ… ä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- âœ… éƒ¨ç½²å‰è¿è¡Œæµ‹è¯•
- âœ… ä¿æŒä»£ç å’Œæ–‡æ¡£åŒæ­¥
- âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯
- âœ… å®šæœŸæŸ¥çœ‹æ—¥å¿—
- âœ… åŠæ—¶å¤‡ä»½é‡è¦æ•°æ®

## ğŸ› ï¸ å¼€å‘å·¥å…·

### å¿…å¤‡å·¥å…·
- **Node.js** >= 16.x
- **npm** >= 8.x
- **Git**
- **sshpass** (ç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²)
- **curl** (ç”¨äºæµ‹è¯• API)

### æ¨èå·¥å…·
- **VS Code** æˆ– **Cursor** (ä»£ç ç¼–è¾‘å™¨)
- **Postman** æˆ– **Insomnia** (API æµ‹è¯•)
- **MongoDB Compass** (æ•°æ®åº“ç®¡ç†)
- **Redis Desktop Manager** (Redis ç®¡ç†)

### VS Code æ‰©å±•æ¨è
- ESLint
- Prettier
- GitLens
- MongoDB for VS Code
- REST Client

## ğŸ“š ç›¸å…³æ–‡æ¡£

- éƒ¨ç½²æŒ‡å—: [DEPLOYMENT.md](mdc:DEPLOYMENT.md)
- æµ‹è¯•æ–‡æ¡£: [testing.mdc](mdc:.cursor/rules/testing.mdc)
- æ•…éšœæ’æŸ¥: [troubleshooting.mdc](mdc:.cursor/rules/troubleshooting.mdc)
- å¿«é€Ÿå‚è€ƒ: [QUICK_REFERENCE.md](mdc:QUICK_REFERENCE.md)
- å·¥å…·æ–‡æ¡£: [scripts/README.md](mdc:scripts/README.md)

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å°æ­¥æäº¤**: é¢‘ç¹æäº¤å°çš„ã€ç‹¬ç«‹çš„æ›´æ”¹
2. **æµ‹è¯•é©±åŠ¨**: å…ˆå†™æµ‹è¯•ï¼Œå†å†™ä»£ç 
3. **ä»£ç å®¡æŸ¥**: é‡è¦æ›´æ”¹å‰è¯·åŒäº‹å®¡æŸ¥
4. **æ–‡æ¡£åŒæ­¥**: ä»£ç æ›´æ”¹æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£
5. **æ—¥å¿—è®°å½•**: å…³é”®æ“ä½œæ·»åŠ æ—¥å¿—
6. **é”™è¯¯å¤„ç†**: æ‰€æœ‰å¼‚æ­¥æ“ä½œä½¿ç”¨ try-catch
7. **å®‰å…¨æ„è¯†**: ä¸æäº¤æ•æ„Ÿä¿¡æ¯åˆ° Git
8. **æ€§èƒ½ä¼˜åŒ–**: å…³æ³¨æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡
9. **ä»£ç å¤ç”¨**: æå–å…¬å…±é€»è¾‘åˆ°å·¥å…·å‡½æ•°
10. **æŒç»­æ”¹è¿›**: å®šæœŸé‡æ„å’Œä¼˜åŒ–ä»£ç 
