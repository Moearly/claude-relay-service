# ğŸ‰ éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

## âœ… é…ç½®çŠ¶æ€

**æ—¶é—´**: 2025-10-22  
**åŸŸå**: codewith.site  
**çŠ¶æ€**: âœ… é…ç½®å®Œæˆï¼Œç­‰å¾… DNS ä¼ æ’­

---

## ğŸŒ DNS é…ç½®å®Œæˆ

### Cloudflare DNS è®°å½•

| è®°å½•ç±»å‹ | åç§° | æŒ‡å‘ | ä»£ç†çŠ¶æ€ | ç”¨é€” |
|---------|------|------|---------|------|
| CNAME | codewith.site | cname.vercel-dns.com | âšª DNS only | ä¸»ç½‘ç«™ |
| CNAME | www.codewith.site | cname.vercel-dns.com | âšª DNS only | WWW |
| A | api.codewith.site | 156.229.163.86 | ğŸŸ  Proxied | API æœåŠ¡å™¨ |

**Zone ID**: e320022b6ab6c02d2a7ad4ea0d5d0407  
**é…ç½®æ–¹å¼**: é€šè¿‡ Cloudflare API è‡ªåŠ¨é…ç½®

---

## ğŸš€ Vercel éƒ¨ç½²

### å‰ç«¯åº”ç”¨

- **ä¸´æ—¶åœ°å€**: https://commercial-website-dsv1jngsq-martn-leis-projects.vercel.app
- **é¡¹ç›®**: martn-leis-projects/commercial-website
- **API é…ç½®**: https://api.codewith.site
- **æ„å»ºçŠ¶æ€**: âœ… æˆåŠŸ

### å¾…å®Œæˆæ“ä½œ

1. **è®¿é—® Vercel Dashboard æ·»åŠ è‡ªå®šä¹‰åŸŸå**:
   - URL: https://vercel.com/martn-leis-projects/commercial-website/settings/domains
   - æ·»åŠ : `codewith.site`
   - æ·»åŠ : `www.codewith.site` (å¯é€‰)

2. **ç­‰å¾… Vercel éªŒè¯**:
   - Vercel ä¼šè‡ªåŠ¨æ£€æµ‹ DNS è®°å½•
   - è‡ªåŠ¨ç­¾å‘ SSL è¯ä¹¦
   - é€šå¸¸éœ€è¦ 5-30 åˆ†é’Ÿ

---

## ğŸ–¥ï¸ åç«¯æœåŠ¡

### Claude Relay Service

- **æœåŠ¡å™¨ IP**: 156.229.163.86
- **éƒ¨ç½²è·¯å¾„**: /opt/claude-relay-service
- **æœåŠ¡ç«¯å£**: 3000
- **æœåŠ¡çŠ¶æ€**: âœ… è¿è¡Œä¸­
- **ç‰ˆæœ¬**: v1.1.164
- **å¥åº·æ£€æŸ¥**: https://api.codewith.site/health

### éœ€è¦é…ç½®çš„ CORS

ç¡®ä¿åç«¯å…è®¸æ–°åŸŸåçš„è¯·æ±‚ã€‚SSH åˆ°æœåŠ¡å™¨åæ‰§è¡Œï¼š

```bash
cd /opt/claude-relay-service

# æ£€æŸ¥å½“å‰ CORS é…ç½®
grep CORS_ORIGIN .env

# å¦‚æœéœ€è¦æ›´æ–°ï¼Œç¼–è¾‘ .env
# æ·»åŠ æˆ–æ›´æ–°ä»¥ä¸‹è¡Œï¼š
# CORS_ORIGIN=https://codewith.site,https://www.codewith.site

# é‡å¯æœåŠ¡
npm run service:restart

# éªŒè¯æœåŠ¡çŠ¶æ€
npm run service:status
```

---

## ğŸ” éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥ DNS ä¼ æ’­

```bash
# æ£€æŸ¥ä¸»åŸŸå
dig codewith.site

# æ£€æŸ¥ www
dig www.codewith.site

# æ£€æŸ¥ API
dig api.codewith.site
```

æˆ–è®¿é—®åœ¨çº¿å·¥å…·ï¼š
- https://www.whatsmydns.net/
- è¾“å…¥åŸŸåæŸ¥çœ‹å…¨çƒ DNS ä¼ æ’­çŠ¶æ€

### 2. æµ‹è¯•è®¿é—®

ç­‰å¾… DNS ä¼ æ’­åï¼ˆ5-30 åˆ†é’Ÿï¼‰ï¼š

- **å‰ç«¯ç½‘ç«™**: https://codewith.site
- **WWW ç½‘ç«™**: https://www.codewith.site
- **API å¥åº·æ£€æŸ¥**: https://api.codewith.site/health
- **API æ–‡æ¡£**: https://api.codewith.site/api-docs

### 3. SSL è¯ä¹¦

- Vercel ä¼šè‡ªåŠ¨ä¸ºä¸»åŸŸåå’Œ www ç­¾å‘ Let's Encrypt è¯ä¹¦
- Cloudflare ä¼šä¸º API å­åŸŸåæä¾› Universal SSL è¯ä¹¦
- æ‰€æœ‰åŸŸåéƒ½ä¼šè‡ªåŠ¨æ”¯æŒ HTTPS

---

## ğŸ—ï¸ æœ€ç»ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æµè§ˆå™¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                     â”‚
       â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ codewith.site   â”‚              â”‚ api.codewith.siteâ”‚
â”‚ (å‰ç«¯è®¿é—®)       â”‚              â”‚  (API è°ƒç”¨)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                â”‚
         â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare DNS  â”‚              â”‚ Cloudflare Proxy â”‚
â”‚  CNAME Record   â”‚              â”‚   A Record       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                â”‚
         â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel Platform â”‚              â”‚   Your Server    â”‚
â”‚  Global CDN     â”‚              â”‚ 156.229.163.86   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                â”‚
         â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js App   â”‚â”€â”€API Callâ”€â”€â†’ â”‚ Claude Relay     â”‚
â”‚ (commercial-web)â”‚              â”‚   Service        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š é…ç½®ä¼˜åŠ¿

### âœ… æ€§èƒ½ä¼˜åŒ–
- **Vercel Global CDN**: å‰ç«¯å†…å®¹å…¨çƒåŠ é€Ÿ
- **Cloudflare CDN**: API è¯·æ±‚åŠ é€Ÿå’Œç¼“å­˜
- **è‡ªåŠ¨å‹ç¼©**: èµ„æºè‡ªåŠ¨ä¼˜åŒ–

### âœ… å®‰å…¨é˜²æŠ¤
- **DDoS é˜²æŠ¤**: Cloudflare æä¾›è‡ªåŠ¨é˜²æŠ¤
- **SSL/TLS**: å…¨ç«™ HTTPS åŠ å¯†
- **é˜²ç«å¢™**: WAF è§„åˆ™ä¿æŠ¤ API

### âœ… å¯é æ€§
- **é«˜å¯ç”¨**: Vercel å’Œ Cloudflare å¤šåœ°åŒºéƒ¨ç½²
- **è‡ªåŠ¨æ‰©å±•**: æ ¹æ®æµé‡è‡ªåŠ¨è°ƒæ•´
- **å¥åº·ç›‘æ§**: è‡ªåŠ¨æ•…éšœæ£€æµ‹

---

## ğŸ“ åç»­ç»´æŠ¤

### ç›‘æ§

1. **Cloudflare Dashboard**:
   - https://dash.cloudflare.com/
   - æŸ¥çœ‹æµé‡ç»Ÿè®¡ã€å®‰å…¨äº‹ä»¶

2. **Vercel Dashboard**:
   - https://vercel.com/martn-leis-projects/commercial-website
   - æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ã€è®¿é—®ç»Ÿè®¡

3. **åç«¯ç›‘æ§**:
   ```bash
   ssh user@156.229.163.86
   cd /opt/claude-relay-service
   npm run service:status
   npm run service:logs
   ```

### æ›´æ–°éƒ¨ç½²

**å‰ç«¯æ›´æ–°**:
```bash
cd /home/leiyi/codeSpace/ApiRelay/commercial-website
# ä¿®æ”¹ä»£ç å
npx vercel --prod
```

**åç«¯æ›´æ–°**:
```bash
ssh user@156.229.163.86
cd /opt/claude-relay-service
git pull
npm install
npm run service:restart
```

---

## ğŸ¯ å®Œæˆæ¸…å•

- [x] Cloudflare DNS è®°å½•é…ç½®
  - [x] codewith.site â†’ Vercel CNAME
  - [x] www.codewith.site â†’ Vercel CNAME
  - [x] api.codewith.site â†’ æœåŠ¡å™¨ A è®°å½•

- [x] Vercel å‰ç«¯éƒ¨ç½²
  - [x] æ„å»ºæˆåŠŸ
  - [x] API URL é…ç½®ä¸º api.codewith.site
  - [x] ç¯å¢ƒå˜é‡é…ç½®

- [ ] Vercel è‡ªå®šä¹‰åŸŸå
  - [ ] åœ¨ Dashboard æ·»åŠ  codewith.site
  - [ ] ç­‰å¾… SSL è¯ä¹¦ç­¾å‘
  - [ ] éªŒè¯è®¿é—®

- [ ] åç«¯ CORS é…ç½®
  - [ ] æ›´æ–°å…è®¸çš„åŸŸå
  - [ ] é‡å¯æœåŠ¡
  - [ ] æµ‹è¯•è·¨åŸŸè¯·æ±‚

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: åŸŸåæ— æ³•è®¿é—®ï¼Ÿ
**A**: DNS ä¼ æ’­éœ€è¦æ—¶é—´ï¼Œç­‰å¾… 5-30 åˆ†é’Ÿã€‚ä½¿ç”¨ `dig` æˆ– whatsmydns.net æ£€æŸ¥ã€‚

### Q: Vercel åŸŸåéªŒè¯å¤±è´¥ï¼Ÿ
**A**: 
1. ç¡®è®¤ Cloudflare ä»£ç†å·²å…³é—­ï¼ˆç°è‰²äº‘æœµï¼‰
2. ç­‰å¾… DNS ä¼ æ’­å®Œæˆ
3. åœ¨ Vercel ç‚¹å‡» "Refresh" é‡æ–°éªŒè¯

### Q: API è¯·æ±‚ CORS é”™è¯¯ï¼Ÿ
**A**: 
1. SSH åˆ°æœåŠ¡å™¨
2. æ›´æ–° `.env` ä¸­çš„ `CORS_ORIGIN`
3. é‡å¯æœåŠ¡: `npm run service:restart`

### Q: SSL è¯ä¹¦é”™è¯¯ï¼Ÿ
**A**: 
1. Vercel å’Œ Cloudflare ä¼šè‡ªåŠ¨ç­¾å‘è¯ä¹¦
2. é€šå¸¸éœ€è¦å‡ åˆ†é’Ÿ
3. å¯ä»¥åœ¨å„è‡ªçš„ Dashboard æŸ¥çœ‹è¯ä¹¦çŠ¶æ€

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **Vercel æ–‡æ¡£**: https://vercel.com/docs
- **Cloudflare æ–‡æ¡£**: https://developers.cloudflare.com/
- **é¡¹ç›®é…ç½®æ–‡æ¡£**: [CLOUDFLARE_SETUP.md](./CLOUDFLARE_SETUP.md)

---

**é…ç½®å®Œæˆæ—¶é—´**: 2025-10-22  
**é¢„è®¡ä¸Šçº¿æ—¶é—´**: DNS ä¼ æ’­å 30 åˆ†é’Ÿå†…

ğŸ‰ **æ­å–œï¼æ‰€æœ‰é…ç½®å·²å®Œæˆï¼Œç­‰å¾… DNS ä¼ æ’­åå³å¯æ­£å¸¸è®¿é—®ï¼**

