# 🚀 快速开始指南

本指南将帮助你快速部署和使用 Claude Relay Service。

---

## 📋 前置要求

### 系统要求
- **操作系统**: Linux (推荐 Ubuntu 20.04+)
- **Node.js**: >= 18.0.0
- **Redis**: >= 6.0
- **MongoDB**: >= 6.0 (商业化功能需要)
- **内存**: >= 2GB
- **磁盘**: >= 10GB

### 依赖服务
- Redis (必需)
- MongoDB (可选，商业化功能需要)

---

## 🔧 快速部署

### 方法一：使用启动脚本（推荐）

```bash
# 1. 克隆项目
git clone <repository-url>
cd claude-relay-service

# 2. 安装依赖
npm install

# 3. 配置环境
cp .env.example .env
# 编辑 .env 填写配置

# 4. 启动服务
./start.sh

# 或使用后台模式
npm run service:start:daemon
```

### 方法二：使用 Docker

```bash
# 构建镜像
docker build -t claude-relay-service .

# 启动容器
docker-compose up -d

# 查看日志
docker-compose logs -f
```

### 方法三：使用 PM2

```bash
# 安装 PM2
npm install -g pm2

# 启动服务
npm run pm2:start

# 查看状态
npm run pm2:status

# 查看日志
npm run pm2:logs
```

---

## ⚙️ 基础配置

### 1. Redis 配置

编辑 `.env` 文件：

```bash
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=your_password
REDIS_DB=0
```

### 2. 服务端口

```bash
PORT=3000
HOST=0.0.0.0
```

### 3. Claude 账号配置

使用 CLI 添加账号：

```bash
npm run cli account add
```

或手动编辑 `config/accounts.json`：

```json
{
  "accounts": [
    {
      "id": "account1",
      "sessionKey": "your_session_key",
      "enabled": true
    }
  ]
}
```

### 4. 管理员配置

```bash
# 创建管理员账号
npm run cli admin create

# 输入用户名和密码
```

---

## 🔑 API 密钥管理

### 创建 API 密钥

使用管理面板：
```
http://your-server:3000/admin
```

或使用 CLI：
```bash
npm run cli apikey create --name "我的密钥" --permissions claude
```

### 测试 API

```bash
curl -X POST http://localhost:3000/v1/messages \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-20250514",
    "messages": [
      {"role": "user", "content": "Hello!"}
    ],
    "max_tokens": 1024
  }'
```

---

## 📊 服务管理

### 查看服务状态

```bash
npm run service:status
```

### 查看日志

```bash
# 实时日志
npm run service:logs:follow

# 所有日志
npm run service:logs
```

### 重启服务

```bash
npm run service:restart
```

### 停止服务

```bash
npm run service:stop
```

---

## 🔍 健康检查

### 基础健康检查

```bash
curl http://localhost:3000/health
```

响应：
```json
{
  "status": "healthy",
  "timestamp": "2025-10-22T...",
  "uptime": 3600,
  "redis": {
    "status": "connected",
    "latency": 5
  }
}
```

### 详细健康检查

```bash
curl http://localhost:3000/health/detailed
```

---

## 🌐 商业化功能（可选）

### 启用商业化功能

1. 安装 MongoDB
2. 配置 MongoDB 连接
3. 初始化数据库

```bash
# 配置 .env
MONGODB_URI=mongodb://localhost:27017/claude-relay

# 运行迁移
npm run migrate
```

### 创建用户

```bash
# 使用 API
curl -X POST http://localhost:3000/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }'
```

---

## 📱 访问管理面板

### 管理后台

访问: `http://your-server:3000/admin`

默认账号: 
- 用户名: admin
- 密码: 初次设置时配置

### 用户控制台

访问: `http://your-server:3000/console`

---

## 🔧 常见问题

### Q: Redis 连接失败？
**A**: 检查 Redis 是否启动，以及配置是否正确
```bash
redis-cli ping
```

### Q: 端口被占用？
**A**: 修改 `.env` 中的 `PORT` 配置

### Q: 账号无法使用？
**A**: 检查 sessionKey 是否有效
```bash
npm run cli account check <account-id>
```

### Q: API 密钥无效？
**A**: 检查密钥格式和权限
```bash
npm run cli apikey list
```

---

## 📚 下一步

- 阅读 [API 文档](./03-API文档.md) 了解详细接口
- 查看 [部署指南](./05-部署指南.md) 进行生产环境部署
- 参考 [运维手册](./14-运维手册.md) 进行日常维护

---

## 🆘 获取帮助

- 查看 [故障排查](./16-故障排查.md)
- 提交 GitHub Issue
- 联系技术支持

---

**祝你使用愉快！** 🎉

