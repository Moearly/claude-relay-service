# ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿéƒ¨ç½²å’Œä½¿ç”¨ Claude Relay Serviceã€‚

---

## ğŸ“‹ å‰ç½®è¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨è Ubuntu 20.04+)
- **Node.js**: >= 18.0.0
- **Redis**: >= 6.0
- **MongoDB**: >= 6.0 (å•†ä¸šåŒ–åŠŸèƒ½éœ€è¦)
- **å†…å­˜**: >= 2GB
- **ç£ç›˜**: >= 10GB

### ä¾èµ–æœåŠ¡
- Redis (å¿…éœ€)
- MongoDB (å¯é€‰ï¼Œå•†ä¸šåŒ–åŠŸèƒ½éœ€è¦)

---

## ğŸ”§ å¿«é€Ÿéƒ¨ç½²

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd claude-relay-service

# 2. å®‰è£…ä¾èµ–
npm install

# 3. é…ç½®ç¯å¢ƒ
cp .env.example .env
# ç¼–è¾‘ .env å¡«å†™é…ç½®

# 4. å¯åŠ¨æœåŠ¡
./start.sh

# æˆ–ä½¿ç”¨åå°æ¨¡å¼
npm run service:start:daemon
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ Docker

```bash
# æ„å»ºé•œåƒ
docker build -t claude-relay-service .

# å¯åŠ¨å®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ PM2

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨æœåŠ¡
npm run pm2:start

# æŸ¥çœ‹çŠ¶æ€
npm run pm2:status

# æŸ¥çœ‹æ—¥å¿—
npm run pm2:logs
```

---

## âš™ï¸ åŸºç¡€é…ç½®

### 1. Redis é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=your_password
REDIS_DB=0
```

### 2. æœåŠ¡ç«¯å£

```bash
PORT=3000
HOST=0.0.0.0
```

### 3. Claude è´¦å·é…ç½®

ä½¿ç”¨ CLI æ·»åŠ è´¦å·ï¼š

```bash
npm run cli account add
```

æˆ–æ‰‹åŠ¨ç¼–è¾‘ `config/accounts.json`ï¼š

```json
{
  "accounts": [
    {
      "id": "account1",
      "sessionKey": "your_session_key",
      "enabled": true
    }
  ]
}
```

### 4. ç®¡ç†å‘˜é…ç½®

```bash
# åˆ›å»ºç®¡ç†å‘˜è´¦å·
npm run cli admin create

# è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
```

---

## ğŸ”‘ API å¯†é’¥ç®¡ç†

### åˆ›å»º API å¯†é’¥

ä½¿ç”¨ç®¡ç†é¢æ¿ï¼š
```
http://your-server:3000/admin
```

æˆ–ä½¿ç”¨ CLIï¼š
```bash
npm run cli apikey create --name "æˆ‘çš„å¯†é’¥" --permissions claude
```

### æµ‹è¯• API

```bash
curl -X POST http://localhost:3000/v1/messages \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-20250514",
    "messages": [
      {"role": "user", "content": "Hello!"}
    ],
    "max_tokens": 1024
  }'
```

---

## ğŸ“Š æœåŠ¡ç®¡ç†

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
npm run service:status
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æ—¥å¿—
npm run service:logs:follow

# æ‰€æœ‰æ—¥å¿—
npm run service:logs
```

### é‡å¯æœåŠ¡

```bash
npm run service:restart
```

### åœæ­¢æœåŠ¡

```bash
npm run service:stop
```

---

## ğŸ” å¥åº·æ£€æŸ¥

### åŸºç¡€å¥åº·æ£€æŸ¥

```bash
curl http://localhost:3000/health
```

å“åº”ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2025-10-22T...",
  "uptime": 3600,
  "redis": {
    "status": "connected",
    "latency": 5
  }
}
```

### è¯¦ç»†å¥åº·æ£€æŸ¥

```bash
curl http://localhost:3000/health/detailed
```

---

## ğŸŒ å•†ä¸šåŒ–åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### å¯ç”¨å•†ä¸šåŒ–åŠŸèƒ½

1. å®‰è£… MongoDB
2. é…ç½® MongoDB è¿æ¥
3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# é…ç½® .env
MONGODB_URI=mongodb://localhost:27017/claude-relay

# è¿è¡Œè¿ç§»
npm run migrate
```

### åˆ›å»ºç”¨æˆ·

```bash
# ä½¿ç”¨ API
curl -X POST http://localhost:3000/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }'
```

---

## ğŸ“± è®¿é—®ç®¡ç†é¢æ¿

### ç®¡ç†åå°

è®¿é—®: `http://your-server:3000/admin`

é»˜è®¤è´¦å·: 
- ç”¨æˆ·å: admin
- å¯†ç : åˆæ¬¡è®¾ç½®æ—¶é…ç½®

### ç”¨æˆ·æ§åˆ¶å°

è®¿é—®: `http://your-server:3000/console`

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: Redis è¿æ¥å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥ Redis æ˜¯å¦å¯åŠ¨ï¼Œä»¥åŠé…ç½®æ˜¯å¦æ­£ç¡®
```bash
redis-cli ping
```

### Q: ç«¯å£è¢«å ç”¨ï¼Ÿ
**A**: ä¿®æ”¹ `.env` ä¸­çš„ `PORT` é…ç½®

### Q: è´¦å·æ— æ³•ä½¿ç”¨ï¼Ÿ
**A**: æ£€æŸ¥ sessionKey æ˜¯å¦æœ‰æ•ˆ
```bash
npm run cli account check <account-id>
```

### Q: API å¯†é’¥æ— æ•ˆï¼Ÿ
**A**: æ£€æŸ¥å¯†é’¥æ ¼å¼å’Œæƒé™
```bash
npm run cli apikey list
```

---

## ğŸ“š ä¸‹ä¸€æ­¥

- é˜…è¯» [API æ–‡æ¡£](./03-APIæ–‡æ¡£.md) äº†è§£è¯¦ç»†æ¥å£
- æŸ¥çœ‹ [éƒ¨ç½²æŒ‡å—](./05-éƒ¨ç½²æŒ‡å—.md) è¿›è¡Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- å‚è€ƒ [è¿ç»´æ‰‹å†Œ](./14-è¿ç»´æ‰‹å†Œ.md) è¿›è¡Œæ—¥å¸¸ç»´æŠ¤

---

## ğŸ†˜ è·å–å¸®åŠ©

- æŸ¥çœ‹ [æ•…éšœæ’æŸ¥](./16-æ•…éšœæ’æŸ¥.md)
- æäº¤ GitHub Issue
- è”ç³»æŠ€æœ¯æ”¯æŒ

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

